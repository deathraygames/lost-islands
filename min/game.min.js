class Coords{constructor(x,y){if(typeof x==="object"){y=x.y;x=x.x}this.x=x;this.y=y;this.check()}set(x,y){if(x instanceof Coords){coord.check();this.x=coord.x;this.y=coord.y}else{this.x=x;this.y=y}}getDistance(coord){coord.check();return Math.sqrt(Math.pow(this.x-coord.x,2)+Math.pow(this.y-coord.y,2))}check(){if(typeof this.x!=="number"||isNaN(this.x)){console.error("Bad coord.x",this.x);this.x=0}if(typeof this.y!=="number"||isNaN(this.y)){console.error("Bad coord.y",this.y);this.y=0}return this}}function rand(n){return Math.random()*(n||1)}function randInt(n){return Math.floor(rand(n))+1}function randAround(n){var a=rand(n);var b=rand(n);return a-b}class GameImage extends Image{constructor(name){super();this.src="images/"+name+".png"}}class Thing{constructor(world,x,y){let o=this;o.world=world;o.loc=new Coords(x,y);o.name="Thing";o.verb="touch";o.size=16;o.half=o.size/2;o.alpha=1;o.discovered=0;o.minZoom=0}draw(c,s){let o=this;let pos=s.getScreenXY(o.loc);let sz=o.size*Math.max(s.zoom,o.minZoom);let h=o.half*s.zoom;if(o.discovered<.5){c.font="10px 'Lucida Console', Monaco";c.fillStyle="rgba(255,255,255,0.5)";c.fillText("?",pos.x-5.5,pos.y-5.5)}else{if(o.label){let fontSize=Math.ceil(9*s.zoom);if(fontSize>4){c.font=fontSize+"px Verdana";c.shadowColor="#000";c.shadowOffsetX=1;c.shadowOffsetY=-1;c.fillStyle="#fff";c.fillText(o.label,pos.x-o.label.length*2*s.zoom,pos.y-sz+.5)}}c.globalAlpha=o.alpha;if(o.img instanceof Image){c.shadowColor="rgba(0,0,0,0.25)";c.shadowOffsetX=0;c.shadowOffsetY=1;c.shadowBlur=4;c.fillStyle="#fff";c.imageSmoothingEnabled=false;c.drawImage(o.img,pos.x-h,pos.y-h,sz,sz)}}}}class Character extends Thing{constructor(world,x,y,f,job,trades){super(world,x,y);let o=this;o.name="Lost Person";o.job=job;o.trades=trades;o.verb="talk";o.facing=0;o.type="NPC";o.color="#fff";o.speed=3;o.sightMin=14;o.sightMultiplier=50;o.sight=20;o.walkIndex=0;o.traveled=0;o.met={};f=f||"guy";o.guy=new GameImage(f);o.walking=[o.guy,o.guy,o.guy,o.guy];o.slowed=new GameImage(f+"_slowed");o.boat=new GameImage("boat");o.swim=new GameImage("swim");o.meditating=new GameImage("meditate");o.tent=new GameImage("tent");o.img=o.guy;o.inventory={boat:true,tent:true,water:true,coat:true};o.virtues={};o.virtueCount=0;o.alpha=0;o.askIndex=0;o.setImage()}wander(){let i=randInt(4)-1;this.move(i)}move(dir){let o=this;let l=o.loc;let s=o.getSpeed();if(typeof dir==="undefined"){dir=o.facing}o.cancel();if(dir==0){l.y-=s}else if(dir==1){l.x+=s}else if(dir==2){l.y+=s}else if(dir==3){l.x-=s}o.traveled+=s;o.world.keepInBounds(o.loc);o.facing=dir;if(Math.round(o.traveled)%5==0){o.walkIndex++;if(o.walkIndex>=o.walking.length){o.walkIndex=0}}}getSpeed(){let o=this;let s=o.speed;let tt=o.world.getTerrainTypeAt(o.loc);if(tt=="W"){if(o.has("boat")){s*=2}else{s/=7}}else if(tt=="M"){if(!o.has("coat")){s/=5}}else if(tt=="D"){if(!o.has("water")){s/=5}}return s}getFaceLoc(){let o=this;let loc=new Coords(o.loc);let d=o.half;if(o.facing==0){loc.y-=d}else if(o.facing==1){loc.x+=d}else if(o.facing==2){loc.y+=d}else if(o.facing==3){loc.x-=d}return loc}getFootLoc(){let o=this;let loc=new Coords(o.loc);loc.y+=o.half;return loc}setImage(){let o=this;if(o.isMeditating){o.img=o.meditating}else if(o.isCamping){o.img=o.tent}else if(o.isOnWater()){o.img=o.has("boat")?o.boat:o.swim}else if(o.getSpeed()<o.speed){o.img=o.slowed}else{o.img=o.walking[o.walkIndex]}}setSight(){let o=this;let tt=o.world.getTerrainTypeAt(o.loc);o.sight=o.sightMin+o.sightMultiplier*o.world.light;if(o.has("torch")){if(!o.isOnWater()||o.has("boat")){o.sight*=1.1}o.sight+=randInt(30)==1?.1:0}else{if(tt=="F"){o.sight*=.5}}}setRandomName(){let name="";let n=randInt(2)+randInt(2);let s=["al","aka","beth","brit","co","du","den","far","gen","la","mi","no","pre","sha"];while(n>0){name+=s[randInt(s.length-1)];n--}this.name=name.charAt(0).toUpperCase()+name.slice(1)}isOnWater(){let tt=this.world.getTerrainTypeAt(this.loc);return tt=="W"}has(thing){return this.inventory[thing]}discover(bounds){let o=this;let faceLoc=o.getFaceLoc();o.world.loopOverTerrainInBounds(t=>{let d=faceLoc.getDistance(t.loc);t.visible=d<=o.sight;if(t.visible){t.discovered+=.15;t.discovered=Math.min(t.discovered,1)}else if(d<=o.sight*1.1){if(t.discovered<.6){t.discovered+=.05}}},bounds);o.world.allThings.forEach(thing=>{let d=o.loc.getDistance(thing.loc);if(d<=o.sight){thing.discovered+=.1;thing.alpha=Math.min(thing.discovered,1)}else{if(thing.discovered>=1){thing.alpha=.3}else{thing.alpha=0}}})}getActionDistance(){return Math.min(30,this.sight)}action(){let o=this;if(o.isCamping||o.isMeditating){o.cancel();return}let nearest=o.world.getNearestThing(o.loc,o.getActionDistance());if(nearest){if(nearest instanceof Character){o.ask(nearest)}else if(nearest instanceof Shrine){o.meditate(nearest)}else if(nearest instanceof Portal){if(o.has("moonstone")){nearest.activateRed();o.speak("A transdimensional red moon gate!")}else{nearest.toggle()}}}else{o.camp()}}camp(){let o=this;if(o.has("tent")&&!o.isOnWater()){o.isCamping=true;o.facing=-1;o.setImage()}}meditate(shrine){let o=this;o.isMeditating=!o.isMeditating;if(o.isMeditating){o.facing=-1}if(o.isMeditating&&shrine){o.virtues[shrine.virtue]=true;o.label="-"+shrine.mantra+"-"}o.virtueCount=0;for(let v in o.virtues){o.virtueCount++}o.setImage();if(o.virtueCount>=8){o.inventory["enlightenment"]=true;o.speak("I have gained enlightnment of all 8 virtues.")}}cancel(){let o=this;o.isCamping=false;o.isMeditating=false;o.label="";o.setImage()}ask(char){let o=this;o.cancel();char.cancel();o.askIndex++;if(o.askIndex>2){o.askIndex=0}if(o.askIndex==0){if(char.name=="Lost Person"){char.setRandomName()}char.speak("Name? I am "+char.name+".");o.met[char.name]=1}else if(o.askIndex==1){char.speak("Job? I am a "+char.job+".")}else if(o.askIndex==2){let deal,demand,supply,dealSupply;for(supply in char.trades){demand=char.trades[supply];if(demand=="free"||o.has(demand)){deal=demand;dealSupply=supply}}if(deal=="free"){char.speak("Take this "+dealSupply+" for free.");char.give(dealSupply,o)}else if(deal){char.speak("Take this "+dealSupply+" for your "+demand+".");char.trade(dealSupply,demand,o)}else{char.speak("I will trade "+demand+" for "+supply+".")}}}give(wut,whom){this.inventory[wut]=false;whom.inventory[wut]=true}trade(give,take,whom){whom.give(take,this);this.give(give,whom)}speak(wut){this.label=wut}}class Player extends Character{constructor(world,x,y){super(world,x,y,"hero");let o=this;o.type="PC";o.inventory={watch:true};o.alpha=1;o.discovered=1;o.name="Stranger";o.label="";o.walking=[o.guy,new GameImage("hero_walk_0"),o.guy,new GameImage("hero_walk_1")]}}class Shrine extends Thing{constructor(world,x,y,v,mantra){super(world,x,y);let o=this;o.world=world;o.virtue=v;o.name="Shrine of "+o.virtue;o.mantra=mantra;o.verb="meditate";o.img=new GameImage("shrine");o.minZoom=.5}}class Portal extends Thing{constructor(world,x,y){super(world,x,y);let o=this;o.world=world;o.name="Moon Gate";o.verb="activate";o.mode=false;o.allPortals=[];o.tpRange=10;o.tpDrop=o.tpRange*1.5;o.redCallback=function(){};o.off=new GameImage("moongate");o.onRed=new GameImage("moongate_red");o.onBlue=new GameImage("moongate_blue");o.img=o.off;o.minZoom=.5}connect(allPortals){this.allPortals=allPortals}keepAwayFromEdge(){let h=this.world.half;let d=this.tpDrop;let loc=this.loc;if(loc.y+d>h){loc.y-=d}else if(loc.y-d<-1*h){loc.y+=d}if(loc.x+d>h){loc.x-=d}else if(loc.x-d<-1*h){loc.x+=d}}checkTeleport(who){let d=this.loc.getDistance(who.loc);if(d<this.tpRange){this.teleport(who)}}teleport(who,redCallback){let o=this;if(o.mode=="blue"){let out;o.allPortals.forEach(p=>{if(p.mode=="blue"&&p!==o){out=p}});if(!out){out=o.allPortals[randInt(o.allPortals.length-1)]}if(out){let outLoc=new Coords(out.loc);out.activate();if(who.facing==0){outLoc.y-=out.tpDrop}else if(who.facing==1){outLoc.x+=out.tpDrop}else if(who.facing==2){outLoc.y+=out.tpDrop}else if(who.facing==3){outLoc.x-=out.tpDrop}who.loc.set(outLoc.x,outLoc.y)}}else if(o.mode=="red"){o.redCallback()}}activate(){let o=this;o.img=o.onBlue;o.mode="blue";let b=0;o.allPortals.forEach(p=>{if(p.mode=="blue"){b++}});console.log("Blues:",b);o.verb="reset all"}deactivate(){let o=this;o.img=o.off;o.mode=false;o.verb="activate"}deactivateAll(){this.allPortals.forEach(p=>{p.deactivate()})}toggle(){let o=this;if(!o.mode){o.activate()}else{o.deactivateAll()}}activateRed(){this.img=this.onRed;this.mode="red"}}class World{constructor(sz){let o=this;o.size=sz;o.half=o.size/2;o.light=1;o.hue=[0,0,0];o.terrainTypes={W:[0,50,150],P:[30,180,20],F:[30,120,50],M:[120,110,120],D:[170,170,90],C:[150,150,70]};o.terrainMarkers=[];o.npcs=[];o.terrain=[];o.shrines=[];o.portals=[];o.allThings=[]}buildTerrainMarkers(){let o=this;let i=o.size/7;while(i-- >0){let xy=o.getRandomLoc(o.terrainMarkers,4);o.terrainMarkers.push(new TerrainMarker(o,xy.x,xy.y))}o.terrainMarkers.push(new TerrainMarker(o,0,0,"P"))}buildNPCs(){let o=this;let jobTrades=[{job:"farmer",trades:{grain:"free"}},{job:"well-digger",trades:{water:"free"}},{job:"hunter",trades:{hide:"free"}},{job:"lumberjack",trades:{wood:"free"}},{job:"bard",trades:{song:"free"}},{job:"shepherd",trades:{wool:"grain"}},{job:"torchbearer",trades:{torch:"bread"}},{job:"baker",trades:{bread:"grain"}},{job:"messenger",trades:{tent:"bread"}},{job:"knitter",trades:{coat:"wool"}},{job:"torchmaker",trades:{torch:"wood"}},{job:"tentmaker",trades:{tent:"hides"}},{job:"shipwright",trades:{boat:"wood"}},{job:"mystic",trades:{moonstone:"enlightenment"}}];let i=0;while(i<40){let xy=o.getRandomLoc();let jt=i<jobTrades.length?jobTrades[i]:jobTrades[randInt(jobTrades.length)-1];o.npcs.push(new Character(o,xy.x,xy.y,"guy",jt.job,jt.trades));i++}o.allThings=o.allThings.concat(o.npcs)}buildShrines(){let o=this;let virtues=["Honesty","Compassion","Valor","Justice","Honor","Sacrifice","Spirituality","Humility"];let mantras=["Ahm","Mu","Ra","Beh","Summ","Cah","Om","Lum"];let i=8;let minD=o.size/10;while(i-- >0){let xy=o.getRandomLoc(o.shrines,minD);o.shrines.push(new Shrine(o,xy.x,xy.y,virtues[i],mantras[i]))}o.allThings=o.allThings.concat(o.shrines)}buildPortals(redCallback){let o=this;let i=8;let minD=o.size/2;while(i-- >0){let xy=o.getRandomLoc(o.portals,minD);let p=new Portal(o,xy.x,xy.y);p.keepAwayFromEdge();o.portals.push(p);o.terrainMarkers.push(new TerrainMarker(o,xy.x,xy.y,"P"))}o.allThings=o.allThings.concat(o.portals);o.portals.forEach(p=>{p.connect(o.portals);p.redCallback=redCallback})}buildTerrain(){let ts=2;let o=this;o.loopOverPixels((x,y,i)=>{let k=o.getTerrainTypeAt(x,y);o.terrain.push(new TerrainPoint(o,x,y,k,ts))},ts)}getRandomLoc(notNear,minD,c){let o=this;let loc=new Coords(randInt(o.size)-o.half,randInt(o.size)-o.half);if(typeof c==="undefined"){c=1e4}if(notNear&&c>0){let tryAgain=false;notNear.forEach(w=>{let d=w.loc.getDistance(loc);if(d<minD){tryAgain=true}});if(tryAgain){return o.getRandomLoc(notNear,--minD,--c)}}return loc}getNearestThing(loc,near){let o=this;let nearThing;near=near||Infinity;o.allThings.forEach(thing=>{let d=loc.getDistance(thing.loc);if(d<=near){near=d;nearThing=thing}});return nearThing}loopOverPixels(fn,sz){let h=this.half;let x=h*-1;let i=0;while(x<=h){let y=h*-1;while(y<=h){fn(x,y,i);i++;y+=sz}x+=sz}}loopOverTerrainInBounds(fn,bounds){let o=this;let i=o.terrain.length-1;while(i>=0){let t=o.terrain[i];if(t.x<bounds.max.x&&t.x>bounds.min.x&&t.y<bounds.max.y&&t.y>bounds.min.y){fn(t)}i--}}getTerrainTypeAt(x,y){let at=new Coords(x,y);let dMin=Infinity;let kMin="Z";let k="Z";this.terrainMarkers.forEach(t=>{let d=t.loc.getDistance(at);d*=t.power;let diff=Math.abs(d-dMin);if(d<dMin){dMin=d;k=t.typeKey;kMin=k}if(diff<50&&kMin=="W"&&t.typeKey!="W"){dMin=d;k="C"}});return k}keepInBounds(loc){let h=this.half;loc.x=Math.min(Math.max(loc.x,h*-1),h);loc.y=Math.min(Math.max(loc.y,h*-1),h)}draw(c,s){let o=this;let bounds=s.getBoundaries();o.loopOverTerrainInBounds(t=>{t.draw(c,s)},bounds)}}class TerrainPoint{constructor(w,x,y,k,sz){let o=this;o.x=x;o.y=y;o.size=sz;o.loc=new Coords(x,y);o.typeKey=k;o.world=w;o.discovered=0;o.visible=false;o.color=w.terrainTypes[k].slice(0);o.color.forEach((c,i)=>{o.color[i]=Math.max(c-randInt(25),0)});o.hp=1}getColorStyle(light,hue){let o=this;let c=o.color.slice(0);if(o.visible){if(o.typeKey=="W"){light=light*(randInt(500)==1)?1.1:1}}else{let wa=(c[0]+c[1]+c[2])/3*2;c.forEach((co,i)=>{c[i]=(co+wa)/3});light*=.9;if(o.typeKey=="W"){light*=.8}}light*=o.hp;c.forEach((co,i)=>{c[i]=Math.round(co*light+hue[i])});return"rgba("+c.join(",")+","+o.discovered+")"}draw(c,s){let o=this;if(o.discovered){let xy=s.getScreenXY(o.loc);let sz=Math.ceil(o.size*s.zoom);c.fillStyle=o.getColorStyle(o.world.light,o.world.hue);c.fillRect(xy.x,xy.y,sz,sz)}}}class TerrainMarker extends Thing{constructor(w,x,y,k){super(w,x,y);let r=rand();if(typeof k!="string"){let d=this.loc.getDistance(new Coords(0,0));if(r<d/w.half)k="W";else{r=rand();if(r<.5)k="P";else if(r<.8)k="F";else if(r<.9)k="M";else k="D"}}this.typeKey=k;this.power=15+randInt(5)}draw(c,s){let pos=s.getScreenXY(this.loc);let color=this.world.terrainTypes[this.typeKey];let r=color[0]+40,g=color[1]+40,b=color[2];c.fillStyle="rgb("+r+","+g+","+b+")";c.fillRect(pos.x,pos.y,4*s.zoom,4*s.zoom)}}class Screen{constructor(id,multiplier,focus){var o=this;o.id=id;o.multiplier=multiplier;o.canvas=null;o.ctx=null;o.zoom=1;o.size=new Coords(0,0);o.half=new Coords(0,0);o.focus=focus}setup(){let o=this;o.canvas=document.getElementById(o.id);o.ctx=o.canvas.getContext("2d");o.ctx.imageSmoothingEnabled=false;o.canvas.style.imageRendering="pixelated";o.setSize();window.onresize=(e=>{o.setSize()})}setSize(){var o=this;var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight,v=o.canvas,m=o.multiplier;o.size.set(x*m,y*m);o.half.set(x*m/2,y*m/2);v.style.width=x+"px";v.style.height=y+"px";v.width=x*m;v.height=y*m}clear(){this.ctx.clearRect(0,0,this.size.x,this.size.y)}draw(what){if(what instanceof Array){what.forEach(w=>{this.draw(w)});return}let c=this.ctx;c.save();if(typeof what.draw==="function"){what.draw(c,this)}else if(typeof what.img==="object"){let pos=this.getScreenXY(what.loc);let sz=what.size*this.zoom;let h=what.half*this.zoom;this.ctx.drawImage(what.img,pos.x-h,pos.y-h,sz,sz)}c.restore()}getBoundaries(){let o=this;return{min:{x:Math.floor(o.focus.x-o.half.x/o.zoom),y:Math.floor(o.focus.y-o.half.y/o.zoom)},max:{x:Math.ceil(o.focus.x+o.half.x/o.zoom),y:Math.ceil(o.focus.y+o.half.y/o.zoom)}}}getFocusOffset(){let o=this;return{x:o.half.x/o.zoom-o.focus.x,y:o.half.y/o.zoom-o.focus.y}}getScreenXY(x,y){let xy=new Coords(x,y);let fo=this.getFocusOffset();return{x:Math.round((xy.x+fo.x)*this.zoom),y:Math.round((xy.y+fo.y)*this.zoom)}}getScreenXYOffset(x,y){let xy=this.getScreenXY(x,y);xy.x+=.5;xy.y+=.5;return xy}zoomIn(){if(this.zoom<3){this.zoom*=1.2}}zoomOut(){if(this.zoom>.2){this.zoom/=1.2}}}class Loop{constructor(fn,t){this.wait=t;this.timer=null;this.fn=fn}start(){this.next(new Date)}next(last){let o=this;let start=new Date;let t=start-last;o.fn(t);let took=new Date-start;let wait=Math.max(o.wait-took,1);o.timer=window.setTimeout(()=>{o.next(start)},wait)}stop(){window.clearInterval(this.timer)}}var PI2=Math.PI*2;class Game{constructor(){var o=this;o.world={};o.pc={};o.screen={};o.loop={};o.time=new Date;o.invOpen=false}gameLoop(t){let o=this;o.advanceTime(t/5);let ct=Math.round(o.time.getMinutes())==0;o.setLight();o.drawTime();o.pc.setSight();o.screen.clear();o.pc.discover(o.screen.getBoundaries());{let nearest=o.world.getNearestThing(o.pc.loc,o.pc.getActionDistance());if(nearest){o.nameElt.innerHTML=nearest.name;o.verbElt.innerHTML="[E] "+nearest.verb;o.nameElt.style.display="block";o.verbElt.style.display="block"}else{o.nameElt.style.display="none";o.verbElt.style.display="none"}}if(o.invOpen){o.drawInventory()}{let i=randInt(o.world.npcs.length)-1;let npc=o.world.npcs[i];if(o.isNighttime()){npc.camp()}else if(randInt(5)==1){npc.wander()}else{npc.move()}}o.world.portals.forEach(p=>{p.checkTeleport(o.pc)});let c=o.screen.ctx;o.screen.draw([o.world,o.world.shrines,o.world.portals,o.world.npcs,o.pc])}advanceTime(t){let o=this;if(o.pc.isCamping){t*=30}else if(o.pc.isMeditating){t*=10}o.time.setSeconds(o.time.getSeconds()+t)}drawTime(){let o=this;if(o.pc.has("watch")){o.timeElt.innerHTML=o.time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}drawInventory(){let o=this;let h="";for(let item in o.pc.inventory){h+="<li>"+item+"</li>"}o.itemsElt.innerHTML=h;h="";for(let v in o.pc.virtues){h+="<li>"+v+"</li>"}o.virtuesElt.innerHTML=h?h:"<li>None</li>";o.virtueCountElt.innerHTML=Math.ceil(o.pc.virtueCount*100/8)+"% complete";let people=0;for(let p in o.pc.met){people++}o.peopleElt.innerHTML=people+"/"+o.world.npcs.length+" met"}isNighttime(){let hr=g.time.getHours();return hr>22||hr<6}setLight(){let o=this;let hr=g.time.getHours();let l;if(hr>12&&hr<24){l=(12-hr%12)/10}else{l=hr/10}if(o.pc.isMeditating){o.world.hue=[0,25,50]}else{o.world.hue=[0,0,0]}o.world.light=Math.min(Math.max(l,.3),1)}start(){let o=this;console.time("start setup");console.log("%c☥","font-size: 400%; color: yellow;","\nStarting the game...");o.setupDOM();o.setupEvents();o.setupData();console.timeEnd("start setup");setTimeout(()=>{console.time("start launch");o.screen.setup();o.loop.start();o.titleElt.style.display="none";o.invElt.style.display="block";o.invOpen=true;o.loadingElt.style.display="none";o.bodyElt.style.display="block";o.pc.speak("Where am I? Lost in a foreign land...");console.timeEnd("start launch")},2e3)}setupData(){let o=this;console.time("build world");let w=o.world=new World(1200);let h=o.loadingElt.innerHTML;function fn(txt){h+=txt;o.loadingElt.innerHTML=h}fn("<br>Generating terrain...");w.buildTerrainMarkers();fn("<br>Growing NPCs...");w.buildNPCs();fn("<br>Creating Shrines...");w.buildShrines();fn("<br>Building Ancient Moon Gates...");w.buildPortals(()=>{o.win()});fn("<br>Assembling the World...<br>");w.buildTerrain();console.timeEnd("build world");console.time("setup other data");o.pc=new Player(o.world,0,0);o.screen=new Screen("g",.25,o.pc.loc);o.loop=new Loop(t=>{o.gameLoop(t)},20);console.timeEnd("setup other data")}setupDOM(){let o=this;o.nameElt=o.elt("what");o.verbElt=o.elt("verb");o.invElt=o.elt("inventory");o.timeElt=o.elt("time");o.itemsElt=o.elt("items");o.virtuesElt=o.elt("virtues");o.titleElt=o.elt("title");o.loadingElt=o.elt("loading");o.bodyElt=o.elt("body");o.winElt=o.elt("win");o.virtueCountElt=o.elt("virtueCount");o.peopleElt=o.elt("people")}elt(id){return document.getElementById(id)}setupEvents(){let o=this;document.addEventListener("keydown",e=>{e.pd=e.preventDefault;switch(e.keyCode){case 37:case 65:o.pc.move(3);o.cancel();e.pd();break;case 38:case 87:o.pc.move(0);o.cancel();e.pd();break;case 39:case 68:o.pc.move(1);o.cancel();e.pd();break;case 40:case 83:o.pc.move(2);o.cancel();e.pd();break;case 187:o.screen.zoomIn();break;case 189:o.screen.zoomOut();break;case 69:case 32:o.pc.action();e.pd();break;case 73:case 9:o.toggleInventory();e.pd();break;case 77:o.pc.meditate();e.pd();break;case 27:o.cancel();e.pd();break;default:console.log(e.keyCode)}},false)}toggleInventory(){let style=this.invElt.style;this.invOpen=style.display=="none";if(this.invOpen){style.display="block"}else{style.display="none"}}cancel(){this.pc.cancel()}win(){this.bodyElt.style.display="none";this.winElt.style.display="block";this.titleElt.style.display="block"}}